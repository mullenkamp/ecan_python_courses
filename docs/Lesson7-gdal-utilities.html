

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-88382509-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>GDAL command line tools &mdash; GeoPython - AutoGIS 1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="GeoPython - AutoGIS 1 documentation" href="index.html"/>
        <link rel="next" title="Exercise 7" href="Exercise-7.html"/>
        <link rel="prev" title="Reading raster as a numerical array" href="Lesson7-read-raster-array.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> GeoPython - AutoGIS
          

          
            
            <img src="_static/logo_hy_geo_135.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                2016 Autumn
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Course information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="course-info.html">General info</a></li>
<li class="toctree-l1"><a class="reference internal" href="Installing_Anacondas_GIS.html">Installing Python + GIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="License-terms.html">License and terms of usage</a></li>
</ul>
<p class="caption"><span class="caption-text">Lesson 1</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Lesson1-Intro-Python-GIS.html">Introduction to Python GIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lesson1-Geometric-Objects.html">Geometric Objects - Spatial Data Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="Exercise-1.html">Exercise 1</a></li>
</ul>
<p class="caption"><span class="caption-text">Lesson 2</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Lesson2-overview.html">Lesson 2 Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lesson2-download-data.html">Download datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lesson2-overview-pandas-geopandas.html">Pandas and Geopandas -modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lesson2-pandas-intro.html">Introduction to Pandas</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lesson2-geopandas-basics.html">Introduction to Geopandas</a></li>
<li class="toctree-l1"><a class="reference internal" href="Exercise-2.html">Exercise 2</a></li>
</ul>
<p class="caption"><span class="caption-text">Lesson 3</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Lesson3-overview.html">Lesson 3 Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lesson3-geocoding.html">Geocoding</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lesson3-table-join.html">Table join</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lesson3-projections.html">Re-projecting data</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lesson3-point-in-polygon.html">Point in Polygon &amp; Intersect</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lesson3-spatial-join.html">Spatial join</a></li>
<li class="toctree-l1"><a class="reference internal" href="Exercise-3.html">Exercise 3</a></li>
</ul>
<p class="caption"><span class="caption-text">Lesson 4</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Lesson4-overview.html">Lesson 4 Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lesson4-download-data.html">Download datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lesson4-geometric-operations.html">Geometric operations</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lesson4-reclassify.html">Data reclassification</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lesson4-nearest-neighbour.html">Nearest Neighbour Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="Exercise-4.html">Exercise 4</a></li>
</ul>
<p class="caption"><span class="caption-text">Lesson 5</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Lesson5-overview.html">Lesson 5 Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lesson5-download-data.html">Download datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lesson5-static-maps.html">Static maps</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lesson5-interactive-map-bokeh.html">Interactive maps with Bokeh</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lesson5-share-on-github.html">Sharing interactive plots on GitHub</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lesson5-interactive-map-folium.html">Interactive maps on Leaflet</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lesson5-World-3D.html">Inspiration: World 3D</a></li>
<li class="toctree-l1"><a class="reference internal" href="Exercise-5.html">Exercise 5</a></li>
</ul>
<p class="caption"><span class="caption-text">Lesson 6</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Lesson6-overview.html">Lesson 6 Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lesson6-arcpy.html">Python in ArcGIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lesson6-toolbox.html">ArcGIS Toolbox</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lesson6-arcpy-script.html">Writing arcpy scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lesson6-run-the-tool.html">Running the Python script from ArcGIS</a></li>
</ul>
<p class="caption"><span class="caption-text">Lesson 7</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Lesson7-overview.html">Lesson 7 Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lesson7-download.html">Download data</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lesson7-read-raster.html">Reading raster files with GDAL</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lesson7-read-raster-array.html">Reading raster as a numerical array</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">GDAL command line tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#clipping-image-with-gdalwarp">Clipping image with gdalwarp</a></li>
<li class="toctree-l2"><a class="reference internal" href="#stacking-layers-with-gdal-merge-py">Stacking layers with gdal_merge.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="#calculations-with-rasters-using-gdal-calc-py">Calculations with rasters using gdal_calc.py</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Exercise-7.html">Exercise 7</a></li>
</ul>
<p class="caption"><span class="caption-text">Lesson 8</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Lesson8-network-analysis.html">Network analysis in Python</a></li>
</ul>
<p class="caption"><span class="caption-text">Final Assignment</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Final-assignment.html">Final assignment</a></li>
</ul>
<p class="caption"><span class="caption-text">Map Challenge 2016</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="map-challenge.html">Map Challenge 2016</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">GeoPython - AutoGIS</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>GDAL command line tools</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="https://github.com/Automating-GIS-processes/2016/blob/master/source/Lesson7-gdal-utilities.rst" class="fa fa-github"> Edit on GitHub</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="gdal-command-line-tools">
<h1>GDAL command line tools<a class="headerlink" href="#gdal-command-line-tools" title="Permalink to this headline">¶</a></h1>
<p>We have now tested some of the basic functions from the Python <a class="reference external" href="https://pcjericks.github.io/py-gdalogr-cookbook/index.html">GDAL/OGR API</a> for reading and inspecting
raster files. However, GDAL also includes
other powerful functions for data translation and processing which are not directly implemented in the library. We will have a closer look on a couple of such
functions:</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference external" href="http://www.gdal.org/gdalwarp.html">gdalwarp</a> for clipping, mosaicing, reprojection and other processes</li>
<li><a class="reference external" href="http://www.gdal.org/gdal_merge.html">gdal_merge.py</a> for mosaicing / stacking images</li>
<li><a class="reference external" href="http://www.gdal.org/gdal_calc.html">gdal_calc.py</a> for raster calculations</li>
</ul>
</div></blockquote>
<p>These tools <strong>need to be run from the Terminal/Command Prompt</strong> or as a <strong>subprocess in Python</strong>. We will now quickly test out these tools in the Terminal window.</p>
<div class="section" id="clipping-image-with-gdalwarp">
<h2>Clipping image with gdalwarp<a class="headerlink" href="#clipping-image-with-gdalwarp" title="Permalink to this headline">¶</a></h2>
<p>Among other tricks, gdalwarp is a very handy tool for quickly clipping your image. We will now practice how to clip the satellite image band based on a bounding box.
Desired extent for the output file is specified using the option <code class="docutils literal"><span class="pre">-te</span></code>:</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="n">gdalwarp</span> <span class="o">-</span><span class="n">te</span> <span class="n">xmin</span> <span class="n">ymin</span> <span class="n">xmax</span> <span class="n">ymax</span> <span class="n">inputfile</span><span class="o">.</span><span class="n">tif</span> <span class="n">outputfile</span><span class="o">.</span><span class="n">tif</span>
</pre></div>
</div>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<p><strong>Task</strong></p>
<p>Clip band 4 of the satellite image so that it covers cloud-free areas in the Turku archipelago (in the North-East corner of the scene).</p>
<p class="last">You can open the band 4 manually in QGIS for defining the corner coordinates.</p>
</div>
<p>Next, let&#8217;s repeat the clipping for all the rest of the bands all at once. For doing this, we will use Python for generating the command for each spectral band in
our scene.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># List filepaths for all bands in the scence</span>
<span class="n">FileList</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">r&#39;/home/geo/LandsatData&#39;</span><span class="p">,</span><span class="s1">&#39;*band*.tif&#39;</span><span class="p">))</span>

<span class="c1"># Define clipping extent</span>
<span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span><span class="n">ymax</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="c1"># INSERT HERE THE CORRECT COORDINATES</span>

<span class="c1"># Generate gdalwarp command for each band</span>
<span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

<span class="k">for</span> <span class="n">fp</span> <span class="ow">in</span> <span class="n">FileList</span><span class="p">:</span>
    <span class="n">inputfile</span> <span class="o">=</span> <span class="n">fp</span>
    <span class="n">outputfile</span> <span class="o">=</span> <span class="n">inputfile</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_clip.tif&quot;</span>

    <span class="n">command</span> <span class="o">+=</span> <span class="s2">&quot;gdalwarp -te </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">inputfile</span><span class="p">,</span> <span class="n">outputfile</span><span class="p">)</span>

<span class="c1"># Write the commands to an .sh file</span>
<span class="n">cmd_file</span> <span class="o">=</span> <span class="s2">&quot;ClipTurkufromLandsat.sh&quot;</span>
<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cmd_file</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>

<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you are working in an windows environment, change the <code class="docutils literal"><span class="pre">.sh</span></code> extension to <code class="docutils literal"><span class="pre">.bat</span></code> which is the Windows equivalent of a <strong>batch</strong> -file with similar
functionalities.</p>
</div>
<p>After running the above script, you should have a file <code class="docutils literal"><span class="pre">ClipTurkufromLandsat.sh</span></code> in your working directory. Open the file (with a text editor) and
check that the commands have been written correctly to the file.</p>
<p>Next, run the file in the Terminal window:</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="n">bash</span> <span class="n">ClipTurkufromLandsat</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<p>Now you should have a bunch of clipped <code class="docutils literal"><span class="pre">.tif</span></code> files ready and you might want to open a few of them in QGIS to check that the process was successful.</p>
</div>
<div class="section" id="stacking-layers-with-gdal-merge-py">
<h2>Stacking layers with gdal_merge.py<a class="headerlink" href="#stacking-layers-with-gdal-merge-py" title="Permalink to this headline">¶</a></h2>
<p>After clipping the image you can for example stack bands 3 (green), 4 (red), and 5 (nir) for visualizing a false-color composite. Merge the layers
with <code class="docutils literal"><span class="pre">gdal_merge.py</span></code> and use the <code class="docutils literal"><span class="pre">-separate</span></code> option for indicating that you wish to save the inputs as separate bands in the output file.</p>
<p>Let&#8217;s try running the command as a subprocess in python:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># Define input and output files</span>
<span class="n">inputfiles</span> <span class="o">=</span>  <span class="s2">&quot;band3_clip.tif band4_clip.tif band5_clip.tif&quot;</span>
<span class="n">outputfile</span> <span class="o">=</span>  <span class="s2">&quot;Landsat8_GreenRedNir.tif&quot;</span>

<span class="c1"># Generate the command</span>
<span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;gdal_merge.py -separate </span><span class="si">%s</span><span class="s2"> -o </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">inputfiles</span><span class="p">,</span> <span class="n">outputfile</span><span class="p">)</span>

<span class="c1"># Run the command. os.system() returns value zero if the command was executed succesfully</span>
<span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</pre></div>
</div>
<p>As a result, you have three bands stacked together in the file <code class="docutils literal"><span class="pre">Landsat8_GreenRedNir.tif</span></code>.</p>
</div>
<div class="section" id="calculations-with-rasters-using-gdal-calc-py">
<h2>Calculations with rasters using gdal_calc.py<a class="headerlink" href="#calculations-with-rasters-using-gdal-calc-py" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal"><span class="pre">Gdal_calc.py</span></code> is a command line raster calculator which can be useful for competing simple repetitive calculations for raster data.</p>
<p>Open the terminal window and execute following command:</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="n">Gdal_calc</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>You should see instructions on the usage and options for the tool. The basic syntax for <code class="docutils literal"><span class="pre">gdal_calc.py</span></code> is the following:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">gdal_calc</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">A</span> <span class="n">input1</span><span class="o">.</span><span class="n">tif</span> <span class="o">-</span> <span class="n">B</span> <span class="n">input2</span><span class="o">.</span><span class="n">tif</span> <span class="p">[</span><span class="n">other_options</span><span class="p">]</span> <span class="o">--</span><span class="n">outfile</span><span class="o">=</span><span class="n">outputfile</span><span class="o">.</span><span class="n">tif</span>
</pre></div>
</div>
<p>From other options, it is useful to notice at least the parameters <code class="docutils literal"><span class="pre">--calc</span></code> for specifying the calculation syntax and <code class="docutils literal"><span class="pre">--creation-option</span></code> (or <code class="docutils literal"><span class="pre">--co</span></code>)
for controlling the output file size:</p>
<blockquote>
<div><ul class="simple">
<li>In the case of two input files <code class="docutils literal"><span class="pre">--calc=&quot;A+B&quot;</span></code> would add files A and B together.</li>
<li>By default output files tend to be huge which will quickly result in problems with disk size and memory. With <code class="docutils literal"><span class="pre">gdal_calc.py</span></code> you can add parameter
<code class="docutils literal"><span class="pre">--co=&quot;COMPRESS=LZW&quot;</span></code> in order to reduce output file size.</li>
</ul>
</div></blockquote>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="Exercise-7.html" class="btn btn-neutral float-right" title="Exercise 7" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Lesson7-read-raster-array.html" class="btn btn-neutral" title="Reading raster as a numerical array" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Henrikki Tenkanen.
      Last updated on Feb 20, 2017.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
    <li><a href="http://project.invalid/">Project Homepage</a> &raquo;</li>

    <div class="footer">
        <img src="../img/GPLv3_Logo.svg">
    </div>
     



</body>
</html>